<link rel="import" href="../bower_components/polymer/polymer.html">
<link rel="import" href="../bower_components/iron-ajax/iron-ajax.html">
<link rel="import" href="../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../bower_components/iron-image/iron-image.html">
<link rel="import" href="../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../bower_components/paper-card/paper-card.html">
<link rel="import" href="../bower_components/paper-input/paper-input.html">
<link rel="import" href="../bower_components/neon-animation/neon-animation.html">
<link rel="import" href="icon-toggle.html">

<dom-module id="cat-app">
  <template>
    <style>
      :host {
        @apply(--layout-horizontal);
        @apply(--layout-wrap);
        --toggle-icon-fill: #607D8B;
      }

      paper-card {
        margin: 10px;
      }

      .header {
        width: 150px;
        height: 200px;
      }

      .header-content {
        @apply(--layout-fit);
        background: linear-gradient(to top, rgba(0, 0, 0, 0.6), rgba(0, 0, 0, 0.1));
      }

      .title {
        margin: 0;
        padding: 16px;
        color: #fff;
        position: absolute;
        bottom: 0;
      }

      .cat-image {
        @apply(--layout-fit);
      }

      iron-icon {
        fill: #F44336;
        float: right;
      }

    </style>

    <template is="dom-repeat" items="[[cats]]" as="cat" on-dom-change="_updateCascadedNodes">
      <paper-card class="cat-card">
        <div class="header paper-card">
          <iron-image class="cat-image" src="images/[[cat.image]]" sizing="cover" preload></iron-image>
          <div class="header-content">
            <h3 class="title">[[cat.breed]]</h3>
          </div>
        </div>
        <div class="card-actions">
          <icon-toggle toggle-icon="star"></icon-toggle>
          <template is="dom-if" if="[[cat.dangerous]]">
            <iron-icon icon="warning"></iron-icon>
          </template>
        </div>

      </paper-card>
    </template>

    <iron-ajax auto url="../data/cats.json" last-response="{{cats}}"></iron-ajax>
  </template>

  <script>
    Polymer({
      is: 'cat-app',
      behaviors: [
        Polymer.NeonAnimatableBehavior,
        Polymer.NeonAnimationRunnerBehavior,
        Polymer.NeonSharedElementAnimatableBehavior
      ],
      properties: {
        animationConfig: {
          type: Object,
          value: function () {
            return {
              'entry': [{
                name: 'fade-in-animation',
                animation: 'fade-in-animation',
                node: this,
                timing: {
                  delay: 500
                }
              }]
            }
          }
        }
      },
      _updateCascadedNodes: function () {
        var nodeList = Polymer.dom(this.root).querySelectorAll('.cat-card');
        this.animationConfig.entry.push({
          name: 'cascaded-animation',
          animation: 'transform-animation',
          transformFrom: 'translate3d(0, 100%, 0)',
          timing: {
            delay: 500
          },
          nodes: Array.prototype.slice.call(nodeList)
        });
        this.playAnimation('entry');
      }
    });
  </script>
</dom-module>
